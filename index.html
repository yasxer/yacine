<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Overdue Report - Upload XLS</title>
</head>
  <style>
    :root{--brand:#2468f2;--muted:#666;--card:#ffffff}
    html,body{height:100%;}
    body { font-family: Inter, Arial, "DejaVu Sans", Tahoma; background:linear-gradient(180deg,#f4f6fb,#ffffff); padding:32px; margin:0; color:#222 }
    .wrap{max-width:920px;margin:0 auto}
    header.app-header{display:flex;align-items:center;gap:16px;margin-bottom:20px}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--brand),#5aa0ff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:20px}
    .title{font-size:20px;font-weight:700}
    .subtitle{color:var(--muted);font-size:13px}
    .container { background:var(--card); padding:22px; border-radius:12px; box-shadow:0 6px 18px rgba(36,104,242,0.08); }
    form .row{display:flex;gap:12px;align-items:center}
    label { display:block; margin-bottom:8px; font-weight:600; font-size:14px; color:#333; }
    input[type=file], select, input[type=email] { width:100%; padding:12px; margin-bottom:12px; border:1px solid #e6eefc; border-radius:8px; background:#fbfcff; box-sizing: border-box; transition:all .2s; font-family:inherit; }
    input[type=email]:focus, select:focus { outline:none; border-color:var(--brand); background:#fff; box-shadow:0 0 0 4px rgba(36,104,242,0.1); }
    button { padding:12px 24px; background:var(--brand); color:#fff; border:none; border-radius:10px; cursor:pointer; font-weight:600; font-size:15px; transition:all .2s; }
    button:hover{filter:brightness(1.1); transform:translateY(-1px); box-shadow:0 4px 12px rgba(36,104,242,0.2); }
    button:disabled { opacity:0.7; cursor:not-allowed; transform:none; }
    .note{color:var(--muted);font-size:13px}
    
    /* Modal Styles */
    .modal-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center; }
    .modal { background:#fff; padding:30px; border-radius:16px; width:90%; max-width:400px; text-align:center; box-shadow:0 10px 25px rgba(0,0,0,0.2); animation: popIn 0.3s ease; }
    .modal h3 { margin-top:0; color:#222; }
    .modal p { color:#666; margin-bottom:20px; }
    .modal-icon { width:60px; height:60px; background:#e0f2fe; color:#2468f2; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 16px; font-size:28px; }
    .modal-icon.success { background:#dcfce7; color:#16a34a; }
    .modal-icon.error { background:#fee2e2; color:#dc2626; }
    .modal button { width:100%; }
    @keyframes popIn { from{transform:scale(0.9);opacity:0} to{transform:scale(1);opacity:1} }

    footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="app-header">
      <div class="logo">R</div>
      <div>
        <div class="title">Overdue Installment Report</div>
        <div class="subtitle">Upload a legacy .XLS file and generate a clean PDF of overdue clients</div>
      </div>
    </header>

    <div class="container">
      <form id="uploadForm" action="generate_report.php" method="post" enctype="multipart/form-data">
        <div class="row">
          <div style="flex:1">
            <label for="xls_file">Excel file (.xls)</label>
            <input type="file" id="xls_file" name="xls_file" accept=".xls" required>
          </div>
          <div style="width:260px">
            <label for="report_type">Report type</label>
            <select id="report_type" name="report_type">
              <option value="overdue">Over 30 days overdue (overdue)</option>
              <option value="24_31">Early Warning 24-31 days (24_31)</option>
              <option value="30_37">Early Warning 30-37 days (30_37)</option>
              <option value="37_44">Advanced Warning 37-44 days (37_44)</option>
            </select>
          </div>
        </div>

        <div style="margin-bottom:12px;">
            <label for="recipient_email">Send Report To (Email)</label>
            <input type="email" id="recipient_email" name="recipient_email" placeholder="example@gmail.com" required>
        </div>

        <div style="display:flex;gap:12px;align-items:center;margin-top:10px">
          <button type="submit" id="submitBtn">Send PDF Report</button>
          <div class="note">Accepted: Excel 97-2003 <strong>.xls</strong> files only.</div>
        </div>
      </form>
    </div>

    <footer>
      <div class="note">Expected columns: A=Client Code, B=Name, C=Contact, E=Solde, F=Date of Last Payment.</div>
    </footer>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-icon" id="modalIcon">✓</div>
      <h3 id="modalTitle">Success!</h3>
      <p id="modalMessage">The report has been sent successfully.</p>
      <button onclick="closeModal()">Close</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('uploadForm');
    const modalOverlay = document.getElementById('modalOverlay');
    const modalTitle = document.getElementById('modalTitle');
    const modalMessage = document.getElementById('modalMessage');
    const modalIcon = document.getElementById('modalIcon');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(form);
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';

      fetch('generate_report.php', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        showModal(data.success, data.message);
      })
      .catch(error => {
        showModal(false, 'An error occurred. Please try again.');
        console.error('Error:', error);
      })
      .finally(() => {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send PDF Report';
      });
    });

    function showModal(isSuccess, message) {
      modalOverlay.style.display = 'flex';
      modalTitle.textContent = isSuccess ? 'Success!' : 'Error';
      modalMessage.textContent = message;
      
      if (isSuccess) {
        modalIcon.className = 'modal-icon success';
        modalIcon.textContent = '✓';
        form.reset();
      } else {
        modalIcon.className = 'modal-icon error';
        modalIcon.textContent = '!';
      }
    }

    function closeModal() {
      modalOverlay.style.display = 'none';
    }
  </script>
